# 100万数据插入测试
## 实验背景
模拟插入100W条店铺数据（店铺名，店铺账号，关键字，创建时间，修改时间），比较各种方式消耗的时间。其中店铺名、店铺账号，关键字使用随机UUID的前3端。创建和修改时间100W数据使用相同的内容以减少消耗。表格无索引字段。数据库使用docker启动MariaDB 10.2，相当于mysql5.6 5.7左右的版本 
## 方式一
使用'createStatement'创建执行器，每次执行1条sql，每个sql插入1条语句。共耗时1689007ms
## 方式二
使用'createStatement'创建执行器，每次执行1条sql，每个sql插入10条数据。共耗时112215ms
## 方式三
使用'PrepareStatement'创建执行器，每次条数据执行一次提交（executeUpdate）。共耗时951052ms
## 方式四
使用'PrepareStatement'创建执行器，每次条1000条数据执行一次提交（executeBatch）。共耗时967479ms
## 总结
1. 每次执行一条sql语句的第一种方式最慢，一条sql插入10条数据的最快，提升1个数量级
2. PrepareStatement使用预编译功能的执行方式比第一种快，但同属一个数据量，还是比第二种慢一个数量级
3. 第3、4中方式速度差不多，无本质改变
4. 与直觉中第四种方式应该是最快的相违背，查阅资料发现预编译功能需要手动开启。
5. jdbc url中增加`&useServerPrepStmts=true&cachePrepStmts=true`开启cache，依然插入效率提升不大
6. 开启mysql查询日志（general_log），在mysql-client执行预编译的日志如下
```mysql
prepare myPreparedStmt from 'insert into store (`name`,`store_account`,`keyword`) values (?,?,?)';    
set @name='name';    
set @store_account='store_account';   
set @keyword='keyword';   
execute myPreparedStmt using @name;
```
日志如下:
```text
		    9 Query	prepare myPreparedStmt from 'insert into store (`name`,`store_account`,`keyword`) values (?,?,?)'
		    9 Prepare	insert into store (`name`,`store_account`,`keyword`) values (?,?,?)
		    9 Query	set @name='name'
		    9 Query	set @store_account='store_account'
		    9 Query	set @keyword='keyword'
		    9 Query	execute myPreparedStmt using @name
```
方法3执行的日志如下
```text
		   11 Prepare	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values (?,?,?,?,?)
		   11 Execute	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('913e1120','ac94','45ec',1606648758073,1606648758073)
201129 19:19:42	   11 Execute	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('ca0e4454','fdbf','4336',1606648758073,1606648758073)
201129 19:19:43	   11 Execute	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('2d39e16d','ce9b','4969',1606648758073,1606648758073)
		   11 Execute	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('51730d69','e961','417a',1606648758073,1606648758073)
201129 19:20:07	   11 Execute	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('ffe57f81','b4c5','4900',1606648758073,1606648758073)
		   11 Execute	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('b922e812','b640','4e2f',1606648758073,1606648758073)
```
方法1执行日志如下
```text
201129 19:42:27	   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('5e032cac','d7db','47f5',1606650141584,1606650141584)
201129 19:42:37	   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('cf2e746b','9a6d','4d3d',1606650141584,1606650141584)
201129 19:42:38	   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('54d48eb3','e35e','44e4',1606650141584,1606650141584)
		   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('4493ff57','4532','4316',1606650141584,1606650141584)
		   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('e89b179a','fbd4','4f5b',1606650141584,1606650141584)
201129 19:42:39	   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('ef5ea91c','5715','46ad',1606650141584,1606650141584)
		   13 Query	insert into store (`name`,`store_account`,`keyword`,`create_time`,`update_time`) values ('a325e3a7','b83f','48e1',1606650141584,1606650141584)
```
可以看出方法1和方法3执行日志明显有区别索引判定方法3是使用预编译了的。

5. 就目前情报分析，在我的环境中执行的sql条数越少速度越快

## 实验日志
## 方式一
使用'createStatement'创建执行器，每次执行1条sql，每个sql插入1条语句。共耗时1689007ms
```text
已插入0条  sql 耗时：12本批次耗时12
已插入10000条  sql 耗时：13874本批次耗时13862
已插入20000条  sql 耗时：27311本批次耗时13437
已插入30000条  sql 耗时：39987本批次耗时12676
已插入40000条  sql 耗时：52108本批次耗时12121
已插入50000条  sql 耗时：63338本批次耗时11230
已插入60000条  sql 耗时：75157本批次耗时11819
已插入70000条  sql 耗时：87535本批次耗时12378
已插入80000条  sql 耗时：101027本批次耗时13492
已插入90000条  sql 耗时：112360本批次耗时11333
已插入100000条  sql 耗时：128131本批次耗时15771
已插入110000条  sql 耗时：143189本批次耗时15058
已插入120000条  sql 耗时：154473本批次耗时11283
已插入130000条  sql 耗时：168924本批次耗时14451
已插入140000条  sql 耗时：183307本批次耗时14383
已插入150000条  sql 耗时：198353本批次耗时15046
已插入160000条  sql 耗时：212256本批次耗时13903
已插入170000条  sql 耗时：224300本批次耗时12044
已插入180000条  sql 耗时：235867本批次耗时11567
已插入190000条  sql 耗时：252774本批次耗时16907
已插入200000条  sql 耗时：267638本批次耗时14864
已插入210000条  sql 耗时：289397本批次耗时21759
已插入220000条  sql 耗时：302037本批次耗时12640
已插入230000条  sql 耗时：315462本批次耗时13425
已插入240000条  sql 耗时：334051本批次耗时18588
已插入250000条  sql 耗时：353822本批次耗时19771
已插入260000条  sql 耗时：369426本批次耗时15604
已插入270000条  sql 耗时：383037本批次耗时13611
已插入280000条  sql 耗时：398918本批次耗时15881
已插入290000条  sql 耗时：410678本批次耗时11760
已插入300000条  sql 耗时：426065本批次耗时15387
已插入310000条  sql 耗时：441654本批次耗时15589
已插入320000条  sql 耗时：462583本批次耗时20929
已插入330000条  sql 耗时：481602本批次耗时19019
已插入340000条  sql 耗时：502680本批次耗时21078
已插入350000条  sql 耗时：526208本批次耗时23527
已插入360000条  sql 耗时：543791本批次耗时17583
已插入370000条  sql 耗时：564270本批次耗时20479
已插入380000条  sql 耗时：581988本批次耗时17718
已插入390000条  sql 耗时：597254本批次耗时15266
已插入400000条  sql 耗时：610825本批次耗时13571
已插入410000条  sql 耗时：624164本批次耗时13339
已插入420000条  sql 耗时：638176本批次耗时14012
已插入430000条  sql 耗时：652029本批次耗时13853
已插入440000条  sql 耗时：666095本批次耗时14066
已插入450000条  sql 耗时：680554本批次耗时14459
已插入460000条  sql 耗时：695116本批次耗时14561
已插入470000条  sql 耗时：709061本批次耗时13945
已插入480000条  sql 耗时：723656本批次耗时14595
已插入490000条  sql 耗时：738354本批次耗时14698
已插入500000条  sql 耗时：753035本批次耗时14681
已插入510000条  sql 耗时：767731本批次耗时14696
已插入520000条  sql 耗时：782647本批次耗时14916
已插入530000条  sql 耗时：797478本批次耗时14831
已插入540000条  sql 耗时：812638本批次耗时15160
已插入550000条  sql 耗时：827560本批次耗时14922
已插入560000条  sql 耗时：842792本批次耗时15232
已插入570000条  sql 耗时：858083本批次耗时15291
已插入580000条  sql 耗时：873584本批次耗时15501
已插入590000条  sql 耗时：889604本批次耗时16020
已插入600000条  sql 耗时：905779本批次耗时16175
已插入610000条  sql 耗时：921556本批次耗时15777
已插入620000条  sql 耗时：937559本批次耗时16003
已插入630000条  sql 耗时：953730本批次耗时16171
已插入640000条  sql 耗时：970128本批次耗时16398
已插入650000条  sql 耗时：986257本批次耗时16129
已插入660000条  sql 耗时：1002827本批次耗时16570
已插入670000条  sql 耗时：1019295本批次耗时16468
已插入680000条  sql 耗时：1036409本批次耗时17114
已插入690000条  sql 耗时：1054323本批次耗时17914
已插入700000条  sql 耗时：1072807本批次耗时18484
已插入710000条  sql 耗时：1091140本批次耗时18333
已插入720000条  sql 耗时：1108827本批次耗时17687
已插入730000条  sql 耗时：1126530本批次耗时17703
已插入740000条  sql 耗时：1143720本批次耗时17190
已插入750000条  sql 耗时：1161369本批次耗时17649
已插入760000条  sql 耗时：1179417本批次耗时18048
已插入770000条  sql 耗时：1201196本批次耗时21779
已插入780000条  sql 耗时：1224413本批次耗时23217
已插入790000条  sql 耗时：1242717本批次耗时18304
已插入800000条  sql 耗时：1261134本批次耗时18417
已插入810000条  sql 耗时：1279221本批次耗时18087
已插入820000条  sql 耗时：1297762本批次耗时18541
已插入830000条  sql 耗时：1316547本批次耗时18785
已插入840000条  sql 耗时：1335267本批次耗时18720
已插入850000条  sql 耗时：1354137本批次耗时18870
已插入860000条  sql 耗时：1373848本批次耗时19711
已插入870000条  sql 耗时：1393419本批次耗时19571
已插入880000条  sql 耗时：1413653本批次耗时20234
已插入890000条  sql 耗时：1434077本批次耗时20424
已插入900000条  sql 耗时：1459539本批次耗时25462
已插入910000条  sql 耗时：1483398本批次耗时23859
已插入920000条  sql 耗时：1510437本批次耗时27039
已插入930000条  sql 耗时：1532254本批次耗时21817
已插入940000条  sql 耗时：1553044本批次耗时20790
已插入950000条  sql 耗时：1574789本批次耗时21745
已插入960000条  sql 耗时：1596626本批次耗时21837
已插入970000条  sql 耗时：1619239本批次耗时22613
已插入980000条  sql 耗时：1641309本批次耗时22070
已插入990000条  sql 耗时：1664674本批次耗时23365
总计消耗1689007ms
```
## 方式二
使用'createStatement'创建执行器，每次执行1条sql，每个sql插入10条数据。共耗时112215ms
```text
已插入0条  sql 耗时：20本批次耗时20
已插入10000条  sql 耗时：1874本批次耗时1853
已插入20000条  sql 耗时：2964本批次耗时1090
已插入30000条  sql 耗时：4113本批次耗时1148
已插入40000条  sql 耗时：5116本批次耗时1003
已插入50000条  sql 耗时：6373本批次耗时1257
已插入60000条  sql 耗时：7633本批次耗时1259
已插入70000条  sql 耗时：8625本批次耗时992
已插入80000条  sql 耗时：9607本批次耗时982
已插入90000条  sql 耗时：10681本批次耗时1074
已插入100000条  sql 耗时：11952本批次耗时1271
已插入110000条  sql 耗时：13210本批次耗时1258
已插入120000条  sql 耗时：14295本批次耗时1084
已插入130000条  sql 耗时：15402本批次耗时1107
已插入140000条  sql 耗时：16780本批次耗时1378
已插入150000条  sql 耗时：17738本批次耗时959
已插入160000条  sql 耗时：18763本批次耗时1024
已插入170000条  sql 耗时：19894本批次耗时1131
已插入180000条  sql 耗时：21029本批次耗时1135
已插入190000条  sql 耗时：22156本批次耗时1127
已插入200000条  sql 耗时：23204本批次耗时1048
已插入210000条  sql 耗时：24287本批次耗时1083
已插入220000条  sql 耗时：25341本批次耗时1054
已插入230000条  sql 耗时：26413本批次耗时1072
已插入240000条  sql 耗时：27455本批次耗时1042
已插入250000条  sql 耗时：28455本批次耗时10000
已插入260000条  sql 耗时：29482本批次耗时1027
已插入270000条  sql 耗时：30494本批次耗时1012
已插入280000条  sql 耗时：31476本批次耗时982
已插入290000条  sql 耗时：32506本批次耗时1030
已插入300000条  sql 耗时：33527本批次耗时1021
已插入310000条  sql 耗时：34576本批次耗时1049
已插入320000条  sql 耗时：35598本批次耗时1022
已插入330000条  sql 耗时：36535本批次耗时937
已插入340000条  sql 耗时：37569本批次耗时1034
已插入350000条  sql 耗时：38636本批次耗时1067
已插入360000条  sql 耗时：39734本批次耗时1098
已插入370000条  sql 耗时：40813本批次耗时1079
已插入380000条  sql 耗时：41894本批次耗时1081
已插入390000条  sql 耗时：43052本批次耗时1158
已插入400000条  sql 耗时：44182本批次耗时1130
已插入410000条  sql 耗时：45297本批次耗时1115
已插入420000条  sql 耗时：46402本批次耗时1105
已插入430000条  sql 耗时：47500本批次耗时1098
已插入440000条  sql 耗时：48555本批次耗时1055
已插入450000条  sql 耗时：49591本批次耗时1036
已插入460000条  sql 耗时：50705本批次耗时1114
已插入470000条  sql 耗时：51806本批次耗时1101
已插入480000条  sql 耗时：52892本批次耗时1086
已插入490000条  sql 耗时：53929本批次耗时1037
已插入500000条  sql 耗时：54942本批次耗时1013
已插入510000条  sql 耗时：55949本批次耗时1007
已插入520000条  sql 耗时：56981本批次耗时1032
已插入530000条  sql 耗时：58058本批次耗时1077
已插入540000条  sql 耗时：59167本批次耗时1109
已插入550000条  sql 耗时：60325本批次耗时1158
已插入560000条  sql 耗时：61443本批次耗时1118
已插入570000条  sql 耗时：62564本批次耗时1121
已插入580000条  sql 耗时：63654本批次耗时1090
已插入590000条  sql 耗时：64740本批次耗时1086
已插入600000条  sql 耗时：65843本批次耗时1103
已插入610000条  sql 耗时：66960本批次耗时1117
已插入620000条  sql 耗时：68075本批次耗时1115
已插入630000条  sql 耗时：69167本批次耗时1092
已插入640000条  sql 耗时：70227本批次耗时1060
已插入650000条  sql 耗时：71240本批次耗时1013
已插入660000条  sql 耗时：72364本批次耗时1124
已插入670000条  sql 耗时：73466本批次耗时1102
已插入680000条  sql 耗时：74600本批次耗时1134
已插入690000条  sql 耗时：75719本批次耗时1119
已插入700000条  sql 耗时：76868本批次耗时1149
已插入710000条  sql 耗时：78017本批次耗时1149
已插入720000条  sql 耗时：79197本批次耗时1180
已插入730000条  sql 耗时：80415本批次耗时1218
已插入740000条  sql 耗时：81636本批次耗时1221
已插入750000条  sql 耗时：82815本批次耗时1179
已插入760000条  sql 耗时：84006本批次耗时1191
已插入770000条  sql 耗时：85169本批次耗时1163
已插入780000条  sql 耗时：86369本批次耗时1200
已插入790000条  sql 耗时：87599本批次耗时1230
已插入800000条  sql 耗时：88764本批次耗时1165
已插入810000条  sql 耗时：89913本批次耗时1149
已插入820000条  sql 耗时：91052本批次耗时1139
已插入830000条  sql 耗时：92216本批次耗时1164
已插入840000条  sql 耗时：93404本批次耗时1188
已插入850000条  sql 耗时：94572本批次耗时1168
已插入860000条  sql 耗时：95733本批次耗时1161
已插入870000条  sql 耗时：96800本批次耗时1067
已插入880000条  sql 耗时：97922本批次耗时1122
已插入890000条  sql 耗时：99081本批次耗时1159
已插入900000条  sql 耗时：100277本批次耗时1195
已插入910000条  sql 耗时：101476本批次耗时1199
已插入920000条  sql 耗时：102653本批次耗时1177
已插入930000条  sql 耗时：103879本批次耗时1226
已插入940000条  sql 耗时：104985本批次耗时1106
已插入950000条  sql 耗时：106201本批次耗时1216
已插入960000条  sql 耗时：107381本批次耗时1180
已插入970000条  sql 耗时：108617本批次耗时1236
已插入980000条  sql 耗时：109842本批次耗时1225
已插入990000条  sql 耗时：111010本批次耗时1168
总计消耗112215ms
```
## 方式三
使用'PrepareStatement'创建执行器，每次条数据执行一次提交（executeUpdate）。共耗时951052ms
```text
已插入0条  sql 耗时：15本批次耗时15
已插入10000条  sql 耗时：10591本批次耗时10576
已插入20000条  sql 耗时：22646本批次耗时12055
已插入30000条  sql 耗时：32143本批次耗时9497
已插入40000条  sql 耗时：41674本批次耗时9531
已插入50000条  sql 耗时：51031本批次耗时9357
已插入60000条  sql 耗时：60337本批次耗时9306
已插入70000条  sql 耗时：70200本批次耗时9863
已插入80000条  sql 耗时：79199本批次耗时8998
已插入90000条  sql 耗时：88517本批次耗时9318
已插入100000条  sql 耗时：98254本批次耗时9737
已插入110000条  sql 耗时：107663本批次耗时9409
已插入120000条  sql 耗时：117375本批次耗时9712
已插入130000条  sql 耗时：126817本批次耗时9442
已插入140000条  sql 耗时：136032本批次耗时9215
已插入150000条  sql 耗时：145400本批次耗时9368
已插入160000条  sql 耗时：154844本批次耗时9444
已插入170000条  sql 耗时：164204本批次耗时9360
已插入180000条  sql 耗时：173641本批次耗时9437
已插入190000条  sql 耗时：183743本批次耗时10102
已插入200000条  sql 耗时：193392本批次耗时9649
已插入210000条  sql 耗时：202585本批次耗时9193
已插入220000条  sql 耗时：212200本批次耗时9615
已插入230000条  sql 耗时：221844本批次耗时9644
已插入240000条  sql 耗时：230968本批次耗时9124
已插入250000条  sql 耗时：240388本批次耗时9420
已插入260000条  sql 耗时：249798本批次耗时9410
已插入270000条  sql 耗时：258990本批次耗时9192
已插入280000条  sql 耗时：268551本批次耗时9561
已插入290000条  sql 耗时：278323本批次耗时9772
已插入300000条  sql 耗时：287486本批次耗时9163
已插入310000条  sql 耗时：297099本批次耗时9613
已插入320000条  sql 耗时：306597本批次耗时9498
已插入330000条  sql 耗时：316015本批次耗时9418
已插入340000条  sql 耗时：325474本批次耗时9459
已插入350000条  sql 耗时：335167本批次耗时9693
已插入360000条  sql 耗时：344485本批次耗时9318
已插入370000条  sql 耗时：354183本批次耗时9698
已插入380000条  sql 耗时：363358本批次耗时9175
已插入390000条  sql 耗时：372554本批次耗时9196
已插入400000条  sql 耗时：382087本批次耗时9533
已插入410000条  sql 耗时：391764本批次耗时9677
已插入420000条  sql 耗时：401311本批次耗时9547
已插入430000条  sql 耗时：410953本批次耗时9642
已插入440000条  sql 耗时：420481本批次耗时9528
已插入450000条  sql 耗时：429619本批次耗时9138
已插入460000条  sql 耗时：439121本批次耗时9502
已插入470000条  sql 耗时：448697本批次耗时9576
已插入480000条  sql 耗时：458438本批次耗时9741
已插入490000条  sql 耗时：467905本批次耗时9467
已插入500000条  sql 耗时：478142本批次耗时10237
已插入510000条  sql 耗时：487449本批次耗时9307
已插入520000条  sql 耗时：497124本批次耗时9675
已插入530000条  sql 耗时：506086本批次耗时8962
已插入540000条  sql 耗时：514903本批次耗时8817
已插入550000条  sql 耗时：523757本批次耗时8854
已插入560000条  sql 耗时：533980本批次耗时10223
已插入570000条  sql 耗时：543279本批次耗时9299
已插入580000条  sql 耗时：552488本批次耗时9209
已插入590000条  sql 耗时：562082本批次耗时9594
已插入600000条  sql 耗时：571654本批次耗时9572
已插入610000条  sql 耗时：581231本批次耗时9577
已插入620000条  sql 耗时：590620本批次耗时9389
已插入630000条  sql 耗时：599770本批次耗时9151
已插入640000条  sql 耗时：609270本批次耗时9499
已插入650000条  sql 耗时：618702本批次耗时9432
已插入660000条  sql 耗时：628178本批次耗时9476
已插入670000条  sql 耗时：637971本批次耗时9793
已插入680000条  sql 耗时：647332本批次耗时9361
已插入690000条  sql 耗时：657074本批次耗时9742
已插入700000条  sql 耗时：666755本批次耗时9681
已插入710000条  sql 耗时：676208本批次耗时9453
已插入720000条  sql 耗时：685652本批次耗时9444
已插入730000条  sql 耗时：694881本批次耗时9229
已插入740000条  sql 耗时：704135本批次耗时9254
已插入750000条  sql 耗时：713706本批次耗时9571
已插入760000条  sql 耗时：723141本批次耗时9435
已插入770000条  sql 耗时：732575本批次耗时9434
已插入780000条  sql 耗时：741980本批次耗时9405
已插入790000条  sql 耗时：751475本批次耗时9495
已插入800000条  sql 耗时：760657本批次耗时9182
已插入810000条  sql 耗时：769732本批次耗时9075
已插入820000条  sql 耗时：779464本批次耗时9732
已插入830000条  sql 耗时：788913本批次耗时9449
已插入840000条  sql 耗时：798614本批次耗时9701
已插入850000条  sql 耗时：808250本批次耗时9636
已插入860000条  sql 耗时：817409本批次耗时9159
已插入870000条  sql 耗时：827012本批次耗时9603
已插入880000条  sql 耗时：836363本批次耗时9351
已插入890000条  sql 耗时：845938本批次耗时9575
已插入900000条  sql 耗时：855124本批次耗时9186
已插入910000条  sql 耗时：864288本批次耗时9164
已插入920000条  sql 耗时：873739本批次耗时9451
已插入930000条  sql 耗时：884178本批次耗时10439
已插入940000条  sql 耗时：893522本批次耗时9344
已插入950000条  sql 耗时：903210本批次耗时9688
已插入960000条  sql 耗时：912677本批次耗时9467
已插入970000条  sql 耗时：921914本批次耗时9237
已插入980000条  sql 耗时：931475本批次耗时9561
已插入990000条  sql 耗时：941454本批次耗时9979
总计消耗951052ms
```
## 方式四
使用'PrepareStatement'创建执行器，每次条1000条数据执行一次提交（executeBatch）。共耗时967479ms
```text
已插入0条  sql 耗时：21本批次耗时21
已插入10000条  sql 耗时：11470本批次耗时11449
已插入20000条  sql 耗时：22707本批次耗时11237
已插入30000条  sql 耗时：33595本批次耗时10888
已插入40000条  sql 耗时：44040本批次耗时10445
已插入50000条  sql 耗时：54283本批次耗时10243
已插入60000条  sql 耗时：63859本批次耗时9576
已插入70000条  sql 耗时：73765本批次耗时9906
已插入80000条  sql 耗时：82967本批次耗时9202
已插入90000条  sql 耗时：92512本批次耗时9545
已插入100000条  sql 耗时：103379本批次耗时10867
已插入110000条  sql 耗时：114072本批次耗时10692
已插入120000条  sql 耗时：124817本批次耗时10745
已插入130000条  sql 耗时：134030本批次耗时9213
已插入140000条  sql 耗时：144531本批次耗时10501
已插入150000条  sql 耗时：154154本批次耗时9623
已插入160000条  sql 耗时：163086本批次耗时8932
已插入170000条  sql 耗时：172497本批次耗时9411
已插入180000条  sql 耗时：182011本批次耗时9514
已插入190000条  sql 耗时：191799本批次耗时9788
已插入200000条  sql 耗时：203529本批次耗时11730
已插入210000条  sql 耗时：217038本批次耗时13509
已插入220000条  sql 耗时：227568本批次耗时10530
已插入230000条  sql 耗时：238539本批次耗时10971
已插入240000条  sql 耗时：249326本批次耗时10787
已插入250000条  sql 耗时：259339本批次耗时10013
已插入260000条  sql 耗时：270890本批次耗时11551
已插入270000条  sql 耗时：280587本批次耗时9697
已插入280000条  sql 耗时：290169本批次耗时9582
已插入290000条  sql 耗时：299947本批次耗时9778
已插入300000条  sql 耗时：309996本批次耗时10049
已插入310000条  sql 耗时：320806本批次耗时10810
已插入320000条  sql 耗时：330012本批次耗时9206
已插入330000条  sql 耗时：339662本批次耗时9650
已插入340000条  sql 耗时：349569本批次耗时9907
已插入350000条  sql 耗时：361271本批次耗时11702
已插入360000条  sql 耗时：370803本批次耗时9532
已插入370000条  sql 耗时：380155本批次耗时9352
已插入380000条  sql 耗时：389513本批次耗时9358
已插入390000条  sql 耗时：398699本批次耗时9186
已插入400000条  sql 耗时：407780本批次耗时9081
已插入410000条  sql 耗时：417088本批次耗时9308
已插入420000条  sql 耗时：426514本批次耗时9426
已插入430000条  sql 耗时：435464本批次耗时8950
已插入440000条  sql 耗时：444781本批次耗时9317
已插入450000条  sql 耗时：453995本批次耗时9214
已插入460000条  sql 耗时：463325本批次耗时9330
已插入470000条  sql 耗时：472893本批次耗时9568
已插入480000条  sql 耗时：482285本批次耗时9392
已插入490000条  sql 耗时：491413本批次耗时9128
已插入500000条  sql 耗时：501455本批次耗时10042
已插入510000条  sql 耗时：511016本批次耗时9561
已插入520000条  sql 耗时：519823本批次耗时8807
已插入530000条  sql 耗时：529017本批次耗时9194
已插入540000条  sql 耗时：538894本批次耗时9877
已插入550000条  sql 耗时：548802本批次耗时9908
已插入560000条  sql 耗时：558241本批次耗时9439
已插入570000条  sql 耗时：567572本批次耗时9331
已插入580000条  sql 耗时：577038本批次耗时9466
已插入590000条  sql 耗时：586142本批次耗时9104
已插入600000条  sql 耗时：595581本批次耗时9439
已插入610000条  sql 耗时：605049本批次耗时9468
已插入620000条  sql 耗时：614675本批次耗时9626
已插入630000条  sql 耗时：624235本批次耗时9560
已插入640000条  sql 耗时：633699本批次耗时9464
已插入650000条  sql 耗时：643088本批次耗时9389
已插入660000条  sql 耗时：652092本批次耗时9004
已插入670000条  sql 耗时：661496本批次耗时9404
已插入680000条  sql 耗时：671503本批次耗时10007
已插入690000条  sql 耗时：680862本批次耗时9359
已插入700000条  sql 耗时：690183本批次耗时9321
已插入710000条  sql 耗时：699336本批次耗时9153
已插入720000条  sql 耗时：708677本批次耗时9341
已插入730000条  sql 耗时：717889本批次耗时9211
已插入740000条  sql 耗时：727254本批次耗时9365
已插入750000条  sql 耗时：736728本批次耗时9474
已插入760000条  sql 耗时：746106本批次耗时9378
已插入770000条  sql 耗时：755407本批次耗时9301
已插入780000条  sql 耗时：764590本批次耗时9183
已插入790000条  sql 耗时：773814本批次耗时9223
已插入800000条  sql 耗时：782509本批次耗时8695
已插入810000条  sql 耗时：791918本批次耗时9409
已插入820000条  sql 耗时：801551本批次耗时9633
已插入830000条  sql 耗时：810716本批次耗时9165
已插入840000条  sql 耗时：820074本批次耗时9358
已插入850000条  sql 耗时：829460本批次耗时9386
已插入860000条  sql 耗时：838748本批次耗时9288
已插入870000条  sql 耗时：847786本批次耗时9038
已插入880000条  sql 耗时：857332本批次耗时9546
已插入890000条  sql 耗时：866715本批次耗时9383
已插入900000条  sql 耗时：876207本批次耗时9492
已插入910000条  sql 耗时：885435本批次耗时9228
已插入920000条  sql 耗时：894801本批次耗时9366
已插入930000条  sql 耗时：904213本批次耗时9412
已插入940000条  sql 耗时：913660本批次耗时9447
已插入950000条  sql 耗时：922821本批次耗时9161
已插入960000条  sql 耗时：931902本批次耗时9081
已插入970000条  sql 耗时：940920本批次耗时9018
已插入980000条  sql 耗时：950071本批次耗时9151
已插入990000条  sql 耗时：959225本批次耗时9154
总计消耗967479ms
```

# 基于spring实现读写分离
## 概述
基于spring提供的`AbstractRoutingDataSource`的`DataSource`抽象配置多个数据源，使用AOP的`ThreadLocal`的方式实现数据源切换，从而达到读写分离的效果。
## 步骤
1. [DynamicDataSource](data-source/src/main/java/club/gaiaproject/homework/source/common/DynamicDataSource.java) 实现,从ThreadLocal中读取标记
2. 创建注解[ReadOnly](data-source/src/main/java/club/gaiaproject/homework/source/common/ReadOnly.java),该注解标记的Controller方法或Service方法会使用从数据源
3. 实现切面[ServiceAOP](data-source/src/main/java/club/gaiaproject/homework/source/aop/ServiceAOP.java),该切面监控ReadOnly注解，触发时向ThreadLocal中写入标记。
4. 配置Bean[DataSourceConfiguration](data-source/src/main/java/club/gaiaproject/homework/source/config/DataSourceConfiguration.java), 在配置中读取2个数据库配置，构建2个HikariDataSource，在用这个两个线程池构建DynamicDataSource，用DynamicDataSource作为spring（JPA）使用的dataSource
## 测试
实现简单的web接口，在[HelloController](data-source/src/main/java/club/gaiaproject/homework/source/controller/HelloController.java) 中，"/master"写主库，在"/slave"主要实现读从库，并在"/slave"添加`@ReadOnly`注解。  
暂时关闭主从同步，通过调用发现，数据正常写入主库，且读数据正常。

# 基于ss实现读写分离
## 概述
shardingsphere是Apache基金会支持的开源项目，他有提供了2中方式实现读写分离，分别是侵入项目的ss-jdbc和非侵入项目的ss-proxy。此次使用ss-jdbc测试读写分类
## 步骤
1. 引入SS-jdbc v4.1.1版本
```java
        <!-- https://mvnrepository.com/artifact/org.apache.shardingsphere/sharding-jdbc-core -->
        <dependency>
            <groupId>org.apache.shardingsphere</groupId>
            <artifactId>sharding-jdbc-spring-boot-starter</artifactId>
            <version>4.1.1</version>
        </dependency>

        <!-- for spring namespace -->
        <dependency>
            <groupId>org.apache.shardingsphere</groupId>
            <artifactId>sharding-jdbc-spring-namespace</artifactId>
            <version>4.1.1</version>
        </dependency>
```
2. 配置ss-jdbc
```yaml
spring:
  shardingsphere:
    datasource:
      # 各个数据域别名
      names: ds0,ds1
      ds0:
        # 数据库驱动类名
        type: com.zaxxer.hikari.HikariDataSource
        drivercClassName: com.mysql.jdbc.Driver
        jdbcUrl: jdbc:mysql://lc0:3306/daenerys?serverTimezone=UTC&useSSL=false&useUnicode=true&characterEncoding=UTF-8
        username: test
        password: test
      ds1:
        type: com.zaxxer.hikari.HikariDataSource
        drivercClassName: com.mysql.jdbc.Driver
        jdbcUrl: jdbc:mysql://localhost:3306/test?serverTimezone=UTC&useSSL=false&useUnicode=true&characterEncoding=UTF-8
        username: root
        password: root
    # 读写平衡配置
    masterslave:
      load-balance-algorithm-type: round_robin
      name: ms
      master-data-source-name: ds1
      slave-data-source-names: ds0
    props:
      sql:
        show: true
    enabled: true
```
3. 其余与正常使用mysql无异
## 测试
与测试spring实现的读写分离方式一致，结果也一致